<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=description content><meta name=generator content="Hugo 0.73.0"><meta name=viewport content="width=device-width,initial-scale=1"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-110967877-1','auto');ga('send','pageview');}</script><link rel=stylesheet href=/css/style.css type=text/css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type=text/css><link rel=alternate href=/index.xml type=application/rss+xml title="Robert Vojta (ùíµùìáùìèùìÄùí∂)"><title>Python IDE on the iPad Pro - Robert Vojta (ùíµùìáùìèùìÄùí∂)</title></head><body><header><div class="container clearfix"><a class=path href=https://www.zrzka.dev/>Home</a>
<span class=caret>% _</span><div class=right><a class=path href=/services/>Services</a></div></div></header><div class=container><main role=main class=article><article class=single itemscope itemtype=http://schema.org/BlogPosting><div class=meta><span class=key>published on</span>
<span class=val><time itemprop=datePublished datetime=2017-10-20>October 20, 2017</time></span>
<span class=key>in</span>
<span class=val><a href=/categories/all>all</a></span><br><span class=key>tags:</span>
<span class=val><a href=/tags/python>python</a>
<a href=/tags/ipad>ipad</a>
<a href=/tags/pythonista>pythonista</a></span></div><h1 class=headline itemprop=headline>Python IDE on the iPad Pro</h1><section class=body itemprop=articleBody><p>My career is kind of colourful. I was working on aircraft systems, VoIP HW & SW, developing Linux
kernel drivers, Linux distributions, OpenOffice.org and many other low level (RTOS) & high level
(desktop applications) stuff. Linux nerd. I said enough one day. I wanted to <em>just work</em> and wasn‚Äôt
willing to continue wasting my time with searching how to workaround this and that. Bye bye Linux,
did spend nice 10 years with you. Not saying it was a bad experience. Nope, I learned a lot and
enjoyed it. But¬†‚Ä¶</p><p>Fast forward, I‚Äôm with Apple for more than 10 years now. Hmm, another 10 years, time to leave? Nope!
Honestly, not excited as I was when I switched, but still pretty happy. Remember the first iPhone?
iPad? Magical devices. Not mentioning first SDK. Exciting times. I did develop lot of applications
for iPhones, iPads and for the desktop. Learned a lot about Objective-C, Objective-C runtime and
all these Apple platforms.</p><p>I also bought every iPad Apple did release. But I didn‚Äôt know what to do with it. Kind of device
for content consumers. I tried, really hard, to use it as a device where I can create something.
But I always struggled, I always gave up and go back to my Mac. Apparently I was trying to use it
for something it wasn‚Äôt designed for. Or it was, but iOS itself wasn‚Äôt ready for it.</p><p>My needs changed few months ago. I no longer work as a full time developer, but rather trying to
lead people and working on new product specifications. Hard change. Lot of new things to learn.</p><p>Do I need to travel with my 15&rdquo; MacBook Pro for this kind of work? Am I willing to try iPad again?
Yup, I am. Bought the iPad Pro 12.9&rdquo;, external keyboard and pencil few months ago. iOS 11, Files,
drag & drop, wonderful applications like <a href=https://workflow.is>Workflow</a>,
<a href=https://www.omnigroup.com/omnigraffle/ios/>OmniGraffle</a>,
<a href=http://omz-software.com/editorial/index.html>Editorial</a>,
<a href=https://ulyssesapp.com>Ulysses</a>,
<a href=https://mindnode.com/mindnode/ios>MindNode</a>
, etc. I have to say that the iPad Pro makes sense as a device where I can create stuff finally.
Took quite some time, but it seems it‚Äôs already here. Suits my needs perfectly.</p><p>What all this has to do with Python IDE on the iPad Pro? I‚Äôm no longer working on our products, but
I didn‚Äôt left programming. And I never will. It‚Äôs quite refreshing to hide myself with all these
devices in some place where no one can disturb me from time to time. We do use
<a href=https://aws.amazon.com>Amazon Web Services</a> a lot. I‚Äôm still kinda involved in scripting, support
tools,¬†‚Ä¶ and we do write all these things in Python. Amazon provides nice package named
<a href=https://boto3.readthedocs.io/en/latest/>boto3</a>:</p><blockquote><p>Boto is the Amazon Web Services (AWS) SDK for Python, which allows Python developers to write
software that makes use of Amazon services like S3 and EC2. Boto provides an easy to use,
object-oriented API as well as low-level direct service access.</p></blockquote><p>I wrote lot of tools, scripts,¬†‚Ä¶ leveraging <em>boto3</em> power to maintain our AWS services. Also wrote
some <a href=https://www.djangoproject.com>django</a> applications for internal use. Can I do this on
my iPad Pro? Quite some effort, but yes, I can! And now, you&rsquo;re finally going to learn how.</p><h2 id=pythonista-forios>Pythonista for¬†iOS</h2><p>Hats off to <a href=http://twitter.com/olemoritz>Ole</a> for writing
<a href=http://omz-software.com/pythonista/index.html>Pythonista for iOS</a>. Seriously, tremendous amount
of work. Quote from the Pythonista website:</p><blockquote><p>Pythonista is a complete development environment for writing Python‚Ñ¢ scripts on your iPad or
iPhone. Lots of examples are included‚Ää‚Äî‚Ääfrom games and animations to plotting, image manipulation,
custom user interfaces, and automation scripts.</p><p>In addition to the powerful standard library, Pythonista provides extensive support for interacting
with native iOS features, like contacts, reminders, photos, location data, and more.</p></blockquote><p>Pythonista supports Python 2.7, 3.5 (beta includes 3.6), standard library, lot of bundled packages
and neat support for native iOS features.</p><p>Release cycle of Pythonista is quite long. Version 3.0 was released an year ago, version 3.1 just
a few days ago. This release cycle leads to a situation, where bundled packages can be outdated
and native iOS features doesn‚Äôt support latest & greatest stuff‚Ää‚Äî‚Äädrag & drop, Files.app, etc.</p><p>What can be done about this? There‚Äôs project named
<a href=https://github.com/ywangd/stash>StaSh‚Ää‚Äî‚ÄäShell for Pythonista</a>. Do I need shell you say?
Bet you do. StaSh does contain useful commands like <em>pip</em>, which allows you to install additional
packages from <a href=https://pypi.python.org/pypi>PyPI</a>. Not all packages are supported. Package must be
<em>pure Python</em>, because of the way how binaries, signatures,¬†‚Ä¶ work on iOS. It&rsquo;s more complicated,
but I&rsquo;m not going to explain it here. Just try it and you‚Äôll see if your package will be
installed or not.</p><p>Remember the first iPhone OS SDK? First apps? Did you ever think this will be possible?
And we just started.</p><p>You should really <a href="https://itunes.apple.com/us/app/pythonista-3/id1085978097?ls=1&mt=8">buy</a>
Pythonista if you‚Äôre into Python.</p><h2 id=dark-side-of-themoon>Dark side of the¬†moon</h2><p>You‚Äôre excited, you started to love Pythonista, but you slowly do realize that you miss something.
Keyboard shortcuts, features like <em>Jump to definition</em>, <em>Open quickly</em> and lot of other things.
Stuff which makes great IDE great.</p><p>I started
<a href="https://github.com/omz/Pythonista-Issues/issues/created_by/zrzka?page=1&q=is%3Aopen+is%3Aissue+author%3Azrzka">filling issues</a>
as a first thing. There‚Äôs more than 330 open issues. Hmm, how quickly will Ole solve them? Am
I willing to wait weeks, months,¬†‚Ä¶? Isn‚Äôt my use case minor one? Will they ever be fixed? Lot of
questions. I‚Äôm a problem solver guy, so, I decided to fix it by myself. That‚Äôs how the
<a href=http://blackmamba.readthedocs.io/>Black Mamba</a> project started.</p><h2 id=prerequisites>Prerequisites</h2><p>I assume that you‚Äôre familiar with following topics:</p><ul><li><a href="https://developer.apple.com/documentation/objectivec/objective_c_runtime?language=objc">Objective-C Runtime</a>
‚Ää‚Äî‚Äämessaging, signatures and type encoding,</li><li><a href="https://developer.apple.com/documentation/uikit/understanding_event_handling_responders_and_the_responder_chain?language=objc">Event handling, responders and the responder chain</a>
‚Äî‚Ää<a href="https://developer.apple.com/documentation/uikit/uiresponder?language=objc">UIResponder</a>,
<a href="https://developer.apple.com/documentation/uikit/uikeycommand?language=objc">UIKeyCommand</a> and
<a href="https://developer.apple.com/documentation/uikit/uievent?language=objc">UIEvent</a>.</li></ul><p>Also I highly recommend to look at <a href=https://docs.python.org/3.6/library/ctypes.html>ctypes</a>
and <a href=http://omz-software.com/pythonista/docs/ios/objc_util.html>objc_util</a> in advance.</p><h2 id=keyboard-shortcuts>Keyboard shortcuts</h2><p>Pythonista provides small amount of shortcuts and I can‚Äôt work without them. Still consider screen
tapping as a slow thing. Let‚Äôs add some of them. We have two basic requirements:</p><ul><li>be at the end of the responder chain, just to avoid clashes with Pythonista view controllers shortcuts,</li><li>have them working even if the view controller hierarchy changes over time.</li></ul><p>It seems that the <code>keyCommands</code> property of the <code>UIApplication</code> perfectly suits our needs. When
compared to the <code>UIViewController</code>, there‚Äôs no <code>addKeyCommand:</code> and we have to found another way how
to modify <code>keyCommands</code> result. Time to poke Objective-C runtime, especially
<a href="https://developer.apple.com/documentation/objectivec/1418901-class_addmethod?language=objc">class_addMethod</a>
and
<a href="https://developer.apple.com/documentation/objectivec/1418901-class_addmethod?language=objc">method_exchangeImplementations</a>
functions. First one allows us to add new methods and second one allows us to exchange their
implementations. It‚Äôs called swizzling. We will need to use these functions more than once, so,
here are Python wrappers:</p><ul><li><a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/util/runtime.py#L16>add_method</a>‚Ää‚Äî‚Ääadds
new method to the class,</li><li><a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/util/runtime.py#L16>swizzle</a> - adds
new method to the class and exchange implementations with the original one.</li></ul><p>Ready for swizzling? Let‚Äôs write custom <code>keyCommands</code> function in Python:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_blackmamba_keyCommands</span>(_self, _cmd):
    obj <span style=color:#f92672>=</span> ObjCInstance(_self)
    commands <span style=color:#f92672>=</span> list(obj<span style=color:#f92672>.</span>originalkeyCommands() <span style=color:#f92672>or</span> [])
    commands<span style=color:#f92672>.</span>extend(_key_commands)
    <span style=color:#66d9ef>return</span> ns(commands)<span style=color:#f92672>.</span>ptr
</code></pre></div><p>Simple one, which gets the original list of key commands and adds our ones from the <code>_key_commands</code>
list (module global variable). We do not need to add new method explicitly, our <code>swizzle</code> function
does it automatically:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>swizzle(<span style=color:#e6db74>&#39;UIApplication&#39;</span>, <span style=color:#e6db74>&#39;keyCommands&#39;</span>, _blackmamba_keyCommands)
</code></pre></div><p>What happened? A picture is worth a thousand words:</p><p><img src=/images/python/swizzle.png alt=Swizzle></p><p>The only remaining thing now is to introduce function, which allows us to register keyboard shortcuts‚Ää‚Äî
<a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/uikit/keyboard.py#L305>register_key_command</a>.
Signature of this function follows.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_register_key_command</span>(input, modifier_flags, function, title<span style=color:#f92672>=</span>None)
</code></pre></div><ul><li><code>input</code> - it can be any string (like letter <code>a</code> for example) or
<a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/uikit/keyboard.py#L194>UIKeyInput</a> enum,
which does contain values for special keys like left arrow.</li><li><code>modifier_flags</code> - it can be <code>int</code> (if you know the correct value) or you can use
<a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/uikit/keyboard.py#L103>UIKeyModifier</a> enum.</li><li><code>function</code> - Python function, no arguments, to call when user presses the shortcut.</li><li><code>title</code> - optional <code>str</code>, discoverability title.</li></ul><p>How to print <em>Hallo</em> with <code>Cmd H</code>?</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> blackmamba.uikit.keyboard <span style=color:#f92672>import</span> (
   register_key_command, UIKeyModifier
)

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>hallo</span>():
   <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Hallo&#39;</span>)

register_key_command(
   <span style=color:#e6db74>&#39;h&#39;</span>,
   UIKeyModifier<span style=color:#f92672>.</span>command,
   hallo
)
</code></pre></div><p>Passed function <code>hallo</code> is wrapped with a function, which does meet Objective-C runtime specs.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>key_command_action</span>(_sel, _cmd, sender):
    function()
</code></pre></div><p>Based on <code>input</code> and <code>modifier_flags</code>, method name is generated. <code>blackMambaHandleKeyCommandH:</code>
in this case.</p><p><code>blackMambaHandleKeyCommandH:</code> method is added to the <code>UIApplication</code> with implementation pointing
to the <code>key_command_action</code>. <code>UIKeyCommand</code> object is created and stored in the <code>_key_commands</code> global list.</p><p><img src=/images/python/key-command-h.png alt="Key Command H diagram"></p><p>And that‚Äôs it. We have a way how to register custom keyboard shortcut, assign it to a function written
in Python.</p><p>Pretty awesome and I can‚Äôt still believe it‚Äôs possible.</p><h2 id=keyboard-events>Keyboard events</h2><p>Imagine you have a dialog and you would like to use keyboard shortcuts for it as well. Like arrow
keys to change selection, enter to confirm selection, <code>Cmd¬†.</code> to close dialog, etc. Global shortcuts
can be reused for this task, but it will bring another sort of issues. We will be forced to remember
which dialog is active, pass events to it from our shortcut handler, forget the dialog when
it‚Äôs closed,¬†‚Ä¶ Sounds complicated to me.</p><p>Let‚Äôs solve this task in a similar way, by swizzling <code>handleKeyUIEvent:</code> (<code>UIApplication</code>). This
method receives physical keyboard events (<code>type = 4</code>) and we can handle them there.</p><blockquote><p>This is private API, don‚Äôt do this in your applications.</p></blockquote><p>Because it‚Äôs very similar to global keyboard shortcuts, here‚Äôre just links to specific implementations:</p><ul><li><a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/uikit/keyboard.py#L384-L398>_blackmamba_handleKeyUIEvent</a>
‚Ää‚Äî‚Ääour implementation of <code>handleKeyUIEvent:</code>,</li><li><a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/uikit/keyboard.py#L402-L412>register_key_event_handler</a>
‚Äî‚Ääevent registration,</li><li><a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/uikit/keyboard.py#L431>unregister_key_event_handler</a>
‚Äî‚Ääevent unregistration.</li></ul><p>And an example how to
<a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/uikit/picker.py#L227-L259>register</a>
and
<a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/uikit/picker.py#L261-L263>unregister</a>
keyboard events.</p><h2 id=drag-drop>Drag &¬†drop</h2><p>There was no drag & drop support prior to Pythonista (311013, beta). I desperately did want to
use it and wrote another script‚Ää‚Äî
<a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/script/drag_and_drop.py>drag_and_drop.py</a>.</p><p>This script demonstrates how to create custom classes, classes that implements protocols like
<code>UITableViewDragDelegate</code> and how to use blocks. I think it‚Äôs pretty self explanatory except one thing.</p><p>There‚Äôs experimental support of blocks in Pythonista. You can write a Python function and create block
from it. Here‚Äôs an example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>block_imp</span>(_cmd):
   <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Hallo&#39;</span>)

block <span style=color:#f92672>=</span> ObjCBlock(
   block_imp,
   restype<span style=color:#f92672>=</span>ctypes<span style=color:#f92672>.</span>c_void_p,
   argtypes<span style=color:#f92672>=</span>[ctypes<span style=color:#f92672>.</span>c_void_p, ctypes<span style=color:#f92672>.</span>c_void_p]
)
</code></pre></div><p>If you need to pass block as an argument somewhere, you can just pass <code>block</code> variable now and that‚Äôs it.
Works. But what if you have to implement block, which receives another block as an argument. There‚Äôs
no support for it in Pythonista.</p><p>I wrote the
<a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/util/runtime.py#L76-L165>ObjCBlockPointer</a>
class, which can be initialised with the block pointer. And then you can call it. Here‚Äôs
<a href=https://github.com/zrzka/blackmamba/blob/v1.3.1/blackmamba/script/drag_and_drop.py#L67>an example</a>
how to use this class. Drag session delegate, which is supposed to load data and then call another block
when the operation completes. It‚Äôs achieved via <code>ObjCBlockPointer</code> class.</p><h2 id=conclusion>Conclusion</h2><p>Do you need additional packages like me? Just install
<a href=https://github.com/ywangd/stash>StaSh</a> and use <code>pip</code>. I did install <code>django</code>, <code>boto3</code> and many other
packages. Do you miss some functionality in Pythonista? Install
<a href=http://blackmamba.readthedocs.io/>Black Mamba</a>.</p><p>I like Pythonista for iOS a lot. I do use it almost on a daily basis even when it‚Äôs not perfect
(nothing‚Äôs perfect) and lacks some features. But because it‚Äôs Python IDE, we have an access to the
Objective-C runtime, nothing can stop you from enhancing it on your own. Like I did. See the
<a href=http://blackmamba.readthedocs.io/en/stable/gallery.html>gallery</a>
of
<a href=https://github.com/zrzka/blackmamba/tree/v1.3.1/blackmamba/script>script</a>
I wrote.</p><p>Can the iPad Pro replace my desktop computer? Yup, it can. There‚Äôre still some edge cases where I
rather use my MacBook Pro, but the number of them is very low.</p><p>Did you ever think that it will be possible to do these kind of things? In an App Store application,
no jailbreak,¬†‚Ä¶ Me not, never, until now. And I can‚Äôt still kind of believe it.</p><p>Learn or die and remember, <strong>sky is the limit</strong>¬†üôÇ</p><p>Again, many thanks to <a href=https://twitter.com/olemoritz>Ole</a> for writing this wonderful piece of
software! Please, <a href="https://itunes.apple.com/us/app/pythonista-3/id1085978097?ls=1&mt=8">buy</a> it to
support Ole‚Äôs ongoing effort to make it better.</p><h2 id=links>Links</h2><ul><li><a href=http://omz-software.com/pythonista/>Pythonista for iOS</a></li><li><a href=https://workingcopyapp.com>Working Copy for iOS</a></li><li><a href=https://github.com/ywangd/stash>StaSh</a></li><li><a href=http://blackmamba.readthedocs.io/>Black Mamba documentation</a></li><li><a href=https://github.com/zrzka/blackmamba>Black Mamba repository</a></li></ul><h2 id=django-notes>Django notes</h2><p>If you‚Äôd like to run Django application on your iPad Pro, don‚Äôt forget to pass following arguments:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>dir <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>abspath(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>dirname(path), <span style=color:#e6db74>&#39;../application&#39;</span>))
sys<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>append(dir)
<span style=color:#75715e># import Django execute_from_command_line</span>
arguments <span style=color:#f92672>=</span> list(sys<span style=color:#f92672>.</span>argv)
arguments<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;runserver&#39;</span>)
arguments<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;--noreload&#39;</span>)
arguments<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;--nothreading&#39;</span>)
arguments<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;-v&#39;</span>)
arguments<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;0&#39;</span>)
logging<span style=color:#f92672>.</span>disable(logging<span style=color:#f92672>.</span>CRITICAL)
<span style=color:#66d9ef>try</span>:
    execute_from_command_line(arguments)
<span style=color:#66d9ef>except</span> <span style=color:#a6e22e>KeyboardInterrupt</span>:
    logging<span style=color:#f92672>.</span>disable(logging<span style=color:#f92672>.</span>NOTSET)
    sys<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>remove(dir)
</code></pre></div><p>Why these arguments? Django is very talkative and it is constantly filling your console with messages.
Every single time there‚Äôs a new message, Pythonista will reveal console, tab with your app becomes
inactive and you have to tap on it to reveal your application. Kind of¬†‚Ä¶ That‚Äôs the reason for
<code>-v 0</code> and disabled logging.</p><p>No threading & reloading is here, because Pythonista supports only one Python thread.</p><p>Still some limitations, but better than nothing. Otherwise it works perfectly.</p></section></article></main></div><footer><div class=container><span class=copyright>&copy; 2020 Robert Vojta (ùíµùìáùìèùìÄùí∂) - <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a> - <a href=/site>Site
Info</a></span></div></footer></body></html>